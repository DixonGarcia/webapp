 <?php

require_once("Libreria_OO.php");
class Saime
{
 function BuscarPersona($Cedula)
 {
  $nacionalidad=substr($Cedula,0,1);
  $ced=substr($Cedula,1);
  $Maquina     = "localhost";
  $UsuarioADM  = "root";
  $ClaveADM    = "root";
  $BaseDeDatos = "eai";
  $Valor = 0;
  $ObjetoConeccion = new ConeccionBD;
  $MiConeccion = $ObjetoConeccion->ConectarBD($Maquina,$UsuarioADM,$ClaveADM,$BaseDeDatos);
  $InstruccionSQL = "select persona.nombre as nombre,persona.apellido as apellido,persona.direccion as direccion,
			persona.telefono as telefono,persona.correo as correo,persona.estadocivil as estadocivil,ciudad.descripcion as ciudad,
			municipio.descripcion as municipio,estado.descripcion as estado
			from ciudad 
			join municipio on ciudad.municipioid=municipio.idmunicipio
			join estado on estado.idestado=municipio.estadoid
			join persona on persona.idpersona='$ced' and nacionalidad='$nacionalidad'";
  $ConjuntoDeRegistros = $ObjetoConeccion->EjecutarSQL($InstruccionSQL,$MiConeccion);
  $Registros = $ObjetoConeccion->BuscarRegistros($ConjuntoDeRegistros);
  if ((int)$Registros==1) 
  {
	$datos[0]="true";
	$datos[1]=$Registros['nombre'];
	$datos[2]=$Registros['apellido'];
	$datos[3]=$Registros['direccion'];
	$datos[4]=$Registros['telefono'];
	$datos[5]=$Registros['correo'];
	$datos[6]=$Registros['estadocivil'];
	$datos[7]=$Registros['ciudad'];
	$datos[8]=$Registros['municipio'];
	$datos[9]=$Registros['estado'];
	$Valor=1;
  }
  else
    $datos=0;
  $ObjetoConeccion->CerrarBD($MiConeccion);
  return $datos;
 } 
function BuscarEstados()
 {
  $Maquina     = "localhost";
  $UsuarioADM  = "root";
  $ClaveADM    = "root";
  $BaseDeDatos = "eai";
  $Valor = 0;
  $ObjetoConeccion = new ConeccionBD;
  $MiConeccion = $ObjetoConeccion->ConectarBD($Maquina,$UsuarioADM,$ClaveADM,$BaseDeDatos);
  $InstruccionSQL = "select * from estado";
  $ConjuntoDeRegistros = $ObjetoConeccion->EjecutarSQL($InstruccionSQL,$MiConeccion);
  if (mysql_num_rows($ConjuntoDeRegistros)>0) 
  {

	$datos[0]="true";
	$datos[1]=mysql_num_rows($ConjuntoDeRegistros);
	$resulado=array();
	$i=2;
	while($resultado=mysql_fetch_array($ConjuntoDeRegistros))
	{
		$datos[$i]['idestado']=$resultado['idestado'];
		$datos[$i]['descripcion']=$resultado['descripcion'];
		$i++;
	}
	$Valor=1;

  }
  else
    $datos=0;
  $ObjetoConeccion->CerrarBD($MiConeccion);
  return $datos;
 } 
function BuscarMunicipios($estado)
 {
  $Maquina     = "localhost";
  $UsuarioADM  = "root";
  $ClaveADM    = "root";
  $BaseDeDatos = "eai";
  $Valor = 0;
  $ObjetoConeccion = new ConeccionBD;
  $estado=ucwords(strtolower($estado));
  $MiConeccion = $ObjetoConeccion->ConectarBD($Maquina,$UsuarioADM,$ClaveADM,$BaseDeDatos);
  $InstruccionSQL = "select municipio.idmunicipio,municipio.descripcion from municipio,estado where municipio.estadoid=estado.idestado and 
			estado.descripcion='$estado' ";
  $ConjuntoDeRegistros = $ObjetoConeccion->EjecutarSQL($InstruccionSQL,$MiConeccion);
  if (mysql_num_rows($ConjuntoDeRegistros)>0) 
  {

	$datos[0]="true";
	$datos[1]=mysql_num_rows($ConjuntoDeRegistros);
	$resulado=array();
	$i=2;
	while($resultado=mysql_fetch_array($ConjuntoDeRegistros))
	{
		$datos[$i]['idmunicipio']=$resultado['idmunicipio'];
		$datos[$i]['descripcion']=$resultado['descripcion'];
		$i++;
	}
	$Valor=1;

  }
  else
    $datos=0;
  $ObjetoConeccion->CerrarBD($MiConeccion);
  return $datos;
 } 
function BuscarCiudadesEstado($estado)
 {
  $Maquina     = "localhost";
  $UsuarioADM  = "root";
  $ClaveADM    = "root";
  $BaseDeDatos = "eai";
  $ObjetoConeccion = new ConeccionBD;
  $estado=ucwords(strtolower($estado));
  $MiConeccion = $ObjetoConeccion->ConectarBD($Maquina,$UsuarioADM,$ClaveADM,$BaseDeDatos);
  $InstruccionSQL = "select ciudad.idciudad,ciudad.descripcion from ciudad
join municipio on ciudad.municipioid=municipio.idmunicipio
join estado on estado.idestado=municipio.estadoid where estado.descripcion='$estado' ";
  $ConjuntoDeRegistros = $ObjetoConeccion->EjecutarSQL($InstruccionSQL,$MiConeccion);
  if (mysql_num_rows($ConjuntoDeRegistros)>0) 
  {

	$datos[0]="true";
	$datos[1]=mysql_num_rows($ConjuntoDeRegistros);
	$resulado=array();
	$i=2;
	while($resultado=mysql_fetch_array($ConjuntoDeRegistros))
	{
		$datos[$i]['idciudad']=$resultado['idciudad'];
		$datos[$i]['descripcion']=$resultado['descripcion'];
		$i++;
	}

  }
  else
    $datos[0]="false";
  $ObjetoConeccion->CerrarBD($MiConeccion);
  return $datos;
 } 
function BuscarCiudadesMunicipio($municipio,$estado)
 {
  $Maquina     = "localhost";
  $UsuarioADM  = "root";
  $ClaveADM    = "root";
  $BaseDeDatos = "eai";
  $Valor = 0;
  $ObjetoConeccion = new ConeccionBD;
  $municipio=ucwords(strtolower($municipio));
  $estado=ucwords(strtolower($estado));
  $MiConeccion = $ObjetoConeccion->ConectarBD($Maquina,$UsuarioADM,$ClaveADM,$BaseDeDatos);
  $InstruccionSQL = "select ciudad.idciudad,ciudad.descripcion from ciudad
			join municipio on ciudad.municipioid=municipio.idmunicipio
			join estado on estado.idestado=municipio.estadoid where estado.descripcion='$estado' and municipio.descripcion='$municipio' ";
  $ConjuntoDeRegistros = $ObjetoConeccion->EjecutarSQL($InstruccionSQL,$MiConeccion);
  if (mysql_num_rows($ConjuntoDeRegistros)>0) 
  {

	$datos[0]="true";
	$datos[1]=mysql_num_rows($ConjuntoDeRegistros);
	$resulado=array();
	$i=2;
	while($resultado=mysql_fetch_array($ConjuntoDeRegistros))
	{
		$datos[$i]['idciudad']=$resultado['idciudad'];
		$datos[$i]['descripcion']=$resultado['descripcion'];
		$i++;
	}
	$Valor=1;

  }
  else
    $datos=0;
  $ObjetoConeccion->CerrarBD($MiConeccion);
  return $datos;
 } 
 function Buscar(&$Datos)
 {
  $Maquina     = "localhost";
  $UsuarioADM  = "root";
  $ClaveADM    = "root";
  $BaseDeDatos = "sapcf";
  $Usuario = $Datos[0];
  $Clave = $Datos[1];
  $Valor = 0;
  $ObjetoConeccion = new ConeccionBD;
  $MiConeccion = $ObjetoConeccion->ConectarBD($Maquina,$UsuarioADM,$ClaveADM,$BaseDeDatos);
  $InstruccionSQL = "Select * From usuarios Where usuario = '" . $Usuario . "' And clave = '" . $Clave ."'";
  $ConjuntoDeRegistros = $ObjetoConeccion->EjecutarSQL($InstruccionSQL,$MiConeccion);
  $Registros = $ObjetoConeccion->BuscarRegistros($ConjuntoDeRegistros);
  if ((int)$Registros==1) 
  {
   $Datos[2] = $Registros['nivel'];
   $Datos[3] = $Registros['foto'];
   $Valor = 1;
  }
  else
  { 
   $Valor = 0;
  }
  $ObjetoConeccion->CerrarBD($MiConeccion);
  return $Valor;
 } 

 function BuscarTodos(&$Datos)
 {
  $Maquina     = "localhost";
  $UsuarioADM  = "root";
  $ClaveADM    = "root";
  $BaseDeDatos = "sapcf";
  $Valor = 0;
  $ObjetoConeccion = new ConeccionBD;
  $MiConeccion = $ObjetoConeccion->ConectarBD($Maquina,$UsuarioADM,$ClaveADM,$BaseDeDatos);
  $InstruccionSQL = "Select * From usuarios";
  $ConjuntoDeRegistros = $ObjetoConeccion->EjecutarSQL($InstruccionSQL,$MiConeccion);
  $Registros = $ObjetoConeccion->BuscarRegistros($ConjuntoDeRegistros);
  if ((int)$Registros>=1) 
  {
   $J = 0;
   $I = 0;
   $Datos[$J][$I]   = $Registros['usuario'];
   $Datos[$J][$I+1] = $Registros['clave'];
   $Datos[$J][$I+2] = $Registros['nivel'];
   $Datos[$J][$I+3] = $Registros['foto'];
   while ($Registros = $ObjetoConeccion->BuscarRegistros($ConjuntoDeRegistros)) 
   {
    $J=$J+1;
    $Datos[$J][$I]   = $Registros['usuario'];
    $Datos[$J][$I+1] = $Registros['clave'];
    $Datos[$J][$I+2] = $Registros['nivel'];
    $Datos[$J][$I+3] = $Registros['foto'];
   }
   $Valor = 1;
  }
  else
  { 
   $Valor = 0;
  }
  $ObjetoConeccion->CerrarBD($MiConeccion);
  return $Valor;
 } 

 function Grabar($Datos)
 {
  $Maquina     = "localhost";
  $UsuarioADM  = "root";
  $ClaveADM    = "root";
  $BaseDeDatos = "sapcf";
 
  $User = $Datos[0];
  $Pass = $Datos[1];
  $Nivel = $Datos[2];
  $Foto = $Datos[3];
  $ValorGrabarActualizar = 0;

  $ObjetoUsuarios = new Usuarios;
  $Valor = $ObjetoUsuarios->Buscar($Datos);
  $ObjetoConeccion = new ConeccionBD;
  $MiConeccion = $ObjetoConeccion->ConectarBD($Maquina,$UsuarioADM,$ClaveADM,$BaseDeDatos);
  //Actualizar
  if ($Valor==1)
  { 
   $InstruccionSQL = "Update usuarios set Nivel='" . $Nivel . "' Where usuario = '" .  $User . "' And clave = '" . $Pass . "'";
  }
  else
  {
  //Insertar
  $InstruccionSQL = "Insert into usuarios (usuario,clave,nivel) values ('" .  $User . "','" . $Pass . "','" . $Nivel . "'," . $Foto . ")"; 
  }
  $ValorGrabarActualizar = $ObjetoConeccion->EjecutarSQL($InstruccionSQL,$MiConeccion);
  $ObjetoConeccion->CerrarBD($MiConeccion);
  return $ValorGrabarActualizar;
 }
 
 function Eliminar($Datos)
 {
  $Maquina     = "localhost";
  $UsuarioADM  = "root";
  $ClaveADM    = "root";
  $BaseDeDatos = "sapcf";
  $Usuario = $Datos[0];
  $Clave = $Datos[1];
  $Valor = 0;
  $ObjetoConeccion = new ConeccionBD;
  $MiConeccion = $ObjetoConeccion->ConectarBD($Maquina,$UsuarioADM,$ClaveADM,$BaseDeDatos);
  $InstruccionSQL = "Delete From usuarios Where usuario = '" . $Usuario . "' And clave = '" . $Clave ."'";
  $Valor = $ObjetoConeccion->EjecutarSQL($InstruccionSQL,$MiConeccion);
  $ObjetoConeccion->CerrarBD($MiConeccion);
  return $Valor;
 }

}
?>
